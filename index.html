<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>AtgAnt by jvz</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">AtgAnt</h1>
        <p class="header">ATG Ant tasks</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/jvz/atg-ant-plugin/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/jvz/atg-ant-plugin/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/jvz/atg-ant-plugin">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/jvz">jvz</a></p>


      </header>
      <section>
        <h1>
<a name="atg-ant-plugin" class="anchor" href="#atg-ant-plugin"><span class="octicon octicon-link"></span></a>ATG Ant Plugin</h1>

<p>atg-ant-plugin is a set of build tools for making the compilation
of ATG Dynamo projects much easier. As its name suggests, this is
an <a href="http://ant.apache.org/">Apache Ant</a> plugin forked from the original
<a href="http://atgant.sf.net/">AtgAnt</a> plugin.</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>First, download the source code:</p>

<pre><code>git clone https://github.com/jvz/atg-ant-plugin.git
</code></pre>

<p>Next, build the project:</p>

<pre><code>ant dist
</code></pre>

<p>Finally, copy the generated <code>target/atg-ant-plugin.jar</code> file to your
Ant library home directory such as <code>~/.ant/lib/</code>. You can also copy
the JAR file to your project (say, <code>lib/</code>), and then reference it as
such in your <code>build.xml</code> file.</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>The following is your ideal <code>build.xml</code> file:</p>

<div class="highlight highlight-xml"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">name=</span><span class="s">"base"</span> <span class="na">default=</span><span class="s">"clean-build"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"atg.home"</span> <span class="na">value=</span><span class="s">"${user.home}/ATG/ATG11.0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;taskdef</span> <span class="na">resource=</span><span class="s">"atgant.xml"</span> <span class="na">classpath=</span><span class="s">"lib/atgant.jar"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">"clean-build"</span> <span class="na">description=</span><span class="s">"Clean and build directory"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;subant</span> <span class="na">target=</span><span class="s">"clean-build"</span> <span class="na">genericantfile=</span><span class="s">"atg-module-build.xml"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;atgRequiredModules</span>
                    <span class="na">atgHome=</span><span class="s">"${atg.home}"</span>
                    <span class="na">modules=</span><span class="s">"proj3,proj1"</span>
                    <span class="na">filters=</span><span class="s">"proj*,base"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/subant&gt;</span>
    <span class="nt">&lt;/target&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>

<p>The <code>taskdef</code> command loads in the new AtgAnt tasks. You should
point the <code>classpath</code> attribute of this task at the location of the
<code>atgant.jar</code> file.</p>

<p>The <code>atgRequiredModules</code> task provides a list of atg modules
referenced by the two modules given, using their <code>META-INF/MANIFEST.MF</code>'s
<code>ATG-Required</code> entries. The filters make sure we only run the
projects with the given names.</p>

<p>The code uses the list of ATG Modules to run another ant script
<code>atg-module-build.xml</code> over each of the found modules</p>

<p>The <code>atg-module-build.xml</code> file looks like this</p>

<div class="highlight highlight-xml"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">name=</span><span class="s">"base"</span> <span class="na">default=</span><span class="s">"clean-build"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"src.dir"</span> <span class="na">value=</span><span class="s">"src"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"build.dir"</span> <span class="na">value=</span><span class="s">"classes"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">"-init"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;available</span> <span class="na">property=</span><span class="s">"src.dir.exists"</span> <span class="na">file=</span><span class="s">"${src.dir}"</span> <span class="na">type=</span><span class="s">"dir"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;atgModuleName</span> <span class="na">atgHome=</span><span class="s">"${atg.home}"</span> <span class="na">property=</span><span class="s">"module.name"</span> <span class="na">module=</span><span class="s">"."</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;echo</span> <span class="na">message=</span><span class="s">"ATG Module ${module.name}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/target&gt;</span>

    <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">"-clean"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;delete</span> <span class="na">dir=</span><span class="s">"${build.dir}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/target&gt;</span>

    <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">"-compile-java"</span> <span class="na">if=</span><span class="s">"src.dir.exists"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;mkdir</span> <span class="na">dir=</span><span class="s">"${build.dir}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;javac</span> <span class="na">srcdir=</span><span class="s">"${src.dir}"</span>
               <span class="na">destdir=</span><span class="s">"${build.dir}"</span>
               <span class="na">debug=</span><span class="s">"on"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;classpath&gt;</span>
                <span class="nt">&lt;atgClasspath</span> <span class="na">atgHome=</span><span class="s">"${atg.home}"</span> <span class="na">modules=</span><span class="s">"."</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/classpath&gt;</span>
        <span class="nt">&lt;/javac&gt;</span>
    <span class="nt">&lt;/target&gt;</span>

    <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">"-build"</span> <span class="na">depends=</span><span class="s">"-compile-java"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">"clean-build"</span> <span class="na">depends=</span><span class="s">"-init,-clean,-build"</span>
            <span class="na">description=</span><span class="s">"Clean and Build module"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</pre></div>

<p>This file will compile a single ATG Module, and the previous file
runs this ant script over all of your project's modules</p>

<p>The <code>atgModuleName</code> task is used to get the name of a particular
module, in this case the module "." -- this is a special name which
means my current build directory. Because this script is run over
each module, it will print out the name of the module it's current
working on.</p>

<p>The <code>atgClasspath</code> task generates the classpath of the current
module. This is the classes listed in the module's <code>META-INF/MANIFEST.MF</code>
file <code>ATG-Class-Path</code> entries, plus the <code>ATG-Class-Path</code> of all the
modules this module is dependent on.</p>

<p>More details on these commands is given later</p>

<p>This system could be extended to perform other ATG module related
tasks, such as running code quality tests or jsp compilation.</p>

<h2>
<a name="atgclasspath-task" class="anchor" href="#atgclasspath-task"><span class="octicon octicon-link"></span></a>AtgClasspath task</h2>

<h3>
<a name="description" class="anchor" href="#description"><span class="octicon octicon-link"></span></a>Description</h3>

<p>Gets the classpath for one or more ATG modules</p>

<p>The classpath is generated by referencing the modules'
<code>META-INF/MANIFEST.MF</code> file's <code>ATG-Class-Path</code> entries. If the
modules reference other modules using <code>ATG-Required</code> entries, then
those modules are added to the classpath. This happens recursively.</p>

<p>The classpath built is in the same order as that will be used by
ATG when the module is run.</p>

<p>The command is mainly used to generate the classpath for compiling
the java code in a module. It could also be used for the classpath
for <a href="http://junit.org/">JUnit</a> tests run against the code in the module.</p>

<h3>
<a name="parameters" class="anchor" href="#parameters"><span class="octicon octicon-link"></span></a>Parameters</h3>

<ul>
<li>
<code>atgHome</code>

<ul>
<li>The directory into which ATG has been installed.</li>
<li>Required.</li>
</ul>
</li>
<li>
<code>modules</code>

<ul>
<li>A list of modules you want to include into the classpath, separated by commas, semi-colons or colons. The module "." means the current ant base directory. You can use simple wildcards such as <code>mod*</code> to indicate all modules starting with "mod", or <code>mod**</code> to mean all modules, including in subdirectories, starting with "mod". For example, <code>module1.base</code> would be matched by <code>mod**</code> but not by <code>mod*</code>.</li>
<li>Optional. Default is "."</li>
</ul>
</li>
<li>
<code>filters</code>

<ul>
<li>Archive file to expand.</li>
<li>Optional.</li>
</ul>
</li>
</ul><h2>
<a name="atgmodulename-task" class="anchor" href="#atgmodulename-task"><span class="octicon octicon-link"></span></a>AtgModuleName task</h2>

<h3>
<a name="description-1" class="anchor" href="#description-1"><span class="octicon octicon-link"></span></a>Description</h3>

<p>Gets the name of the ATG module given to it.</p>

<p>The name of a module is its name as would be recognised by another
ATG module: e.g., <code>PublishingAgent.base</code>.</p>

<p>The command is mainly used to get the name of the module which is
the current Ant base directory, but it could be used simply to
convert directory names from the system format classpath to ATG's
dot notation.</p>

<h3>
<a name="parameters-1" class="anchor" href="#parameters-1"><span class="octicon octicon-link"></span></a>Parameters</h3>

<ul>
<li>
<code>atgHome</code>

<ul>
<li>The directory into which ATG has been installed.</li>
<li>Required.</li>
</ul>
</li>
<li>
<code>module</code>

<ul>
<li>The module whose name is being sought.</li>
<li>Optional. Default is "."</li>
</ul>
</li>
<li>
<code>dir</code>

<ul>
<li>The directory of the module whose name is being sought. You can not specify both <code>dir</code> and <code>module</code>.</li>
<li>Optional. Default is the value from <code>module</code>.</li>
</ul>
</li>
</ul><h2>
<a name="atgrequiredmodules-task" class="anchor" href="#atgrequiredmodules-task"><span class="octicon octicon-link"></span></a>AtgRequiredModules task</h2>

<h3>
<a name="description-2" class="anchor" href="#description-2"><span class="octicon octicon-link"></span></a>Description</h3>

<p>Gets the list of modules need by (and including) the modules given.</p>

<p>The classpath is generated by referencing the modules'
<code>META-INF/MANIFEST.MF</code> file's <code>Required</code> entries. This happens
recursively.</p>

<p>The classpath built is in the same order as that will be used by
ATG when the module is run, with the base modules appearing first.</p>

<p>The command is mainly used to generate a list of modules that need
to be compiled for a particular system. For example, if you provide
your top level module or list of modules to make a .ear, then it
will list all the modules that need to be compiled.</p>

<p>This list will include your custom modules, and ATG's proprietary
modules. You may need to use the <code>filter</code> parameter to restrict the
list of modules returned</p>

<h3>
<a name="parameters-2" class="anchor" href="#parameters-2"><span class="octicon octicon-link"></span></a>Parameters</h3>

<ul>
<li>
<code>atgHome</code>

<ul>
<li>The directory into which ATG has been installed.</li>
<li>Required.</li>
</ul>
</li>
<li>
<code>modules</code>

<ul>
<li>A list of modules you want to include into the classpath, separated by commas, semi-colons or colons. The module "." means the current ant base directory. You can use simple wildcards such as <code>mod*</code> to indicate all modules starting with "mod", or <code>mod**</code> to mean all modules, including in subdirectories, starting with "mod". For example, <code>module1.base</code> would be matched by <code>mod**</code> but not by <code>mod*</code>.</li>
<li>Optional. Default is "."</li>
</ul>
</li>
<li>
<code>filters</code>

<ul>
<li>Archive file to expand.</li>
<li>Optional.</li>
</ul>
</li>
</ul><h2>
<a name="notes" class="anchor" href="#notes"><span class="octicon octicon-link"></span></a>Notes</h2>

<p>Developed by Piran Montford, with the kind help of e2x Ltd. Updated by <a href="https://github.com/jvz" class="user-mention">@jvz</a>.</p>

<p>Warranty THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY
KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE DEVELOPERS OR ANY OTHER CONTRIBUTOR BE LIABLE
FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF
CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
